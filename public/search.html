<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#ffffff">
  <title>æ¤œç´¢ - Article Search</title>
  <link rel="stylesheet" href="/common.css">
  <style>
    .search-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: var(--space-lg);
    }
    @media (min-width: 768px) {
      .search-form {
        flex-direction: row;
      }
      .search-form .input { flex: 1; }
      .search-form .btn { width: auto; padding: 14px 32px; }
    }
    
    .results {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: var(--space-sm);
    }
    .result-title {
      font-size: 16px;
      font-weight: 600;
      line-height: 1.4;
      flex: 1;
    }
    .result-title a {
      color: var(--color-text);
      text-decoration: none;
    }
    .result-title a:active { opacity: 0.7; }
    .result-score {
      background: var(--color-success-light);
      color: #155724;
      padding: var(--space-xs) 10px;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
    }
    .result-summary {
      font-size: 14px;
      color: var(--color-text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }
    .result-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }
    .result-chunk {
      background: var(--color-bg);
      padding: 14px;
      border-radius: var(--radius-md);
      font-size: 14px;
      color: var(--color-text-secondary);
      line-height: 1.7;
      word-break: break-all;
      overflow-wrap: anywhere;
    }
    .result-chunk__label {
      font-size: 12px;
      font-weight: 600;
      color: var(--color-text-muted);
      margin-bottom: var(--space-sm);
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>ğŸ” è¨˜äº‹æ¤œç´¢</h1>
    <nav class="header-nav">
      <a href="/">ğŸ“ è¿½åŠ </a>
      <a href="/articles.html">ğŸ“‹ ä¸€è¦§</a>
      <a href="/ask.html">ğŸ’¬ è³ªå•</a>
      <a href="/feed.xml">ğŸ“¡ RSS</a>
    </nav>
  </header>
  
  <main class="main">
    <p class="text-muted text-sm mb-md">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„æ–‡ç« ã§é¡ä¼¼è¨˜äº‹ã‚’æ¤œç´¢ï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼‰</p>
    
    <form class="search-form" id="searchForm">
      <input type="text" class="input" id="query" placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›..." required autofocus>
      <button type="submit" class="btn btn--primary btn--full" id="searchBtn">æ¤œç´¢</button>
    </form>
    
    <div id="results"></div>
  </main>
  
  <nav class="bottom-nav">
    <a href="/" class="bottom-nav__item"><span class="bottom-nav__icon">ğŸ“</span>è¿½åŠ </a>
    <a href="/articles.html" class="bottom-nav__item"><span class="bottom-nav__icon">ğŸ“‹</span>ä¸€è¦§</a>
    <a href="/search.html" class="bottom-nav__item bottom-nav__item--active"><span class="bottom-nav__icon">ğŸ”</span>æ¤œç´¢</a>
    <a href="/ask.html" class="bottom-nav__item"><span class="bottom-nav__icon">ğŸ’¬</span>è³ªå•</a>
  </nav>

  <script>
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const query = document.getElementById('query').value.trim();
      if (!query) return;
      
      const results = document.getElementById('results');
      const searchBtn = document.getElementById('searchBtn');
      
      searchBtn.disabled = true;
      searchBtn.textContent = 'æ¤œç´¢ä¸­...';
      results.innerHTML = '<div class="state">æ¤œç´¢ä¸­...</div>';
      
      try {
        const response = await fetch('/api/search', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query, limit: 10 })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          results.innerHTML = `<div class="state state--error">ã‚¨ãƒ©ãƒ¼: ${data.error}</div>`;
          return;
        }
        
        const items = data.results || [];
        
        if (items.length === 0) {
          results.innerHTML = '<div class="state">æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</div>';
          return;
        }
        
        results.innerHTML = `<div class="results">${items.map(item => `
          <div class="card">
            <div class="result-header">
              <h3 class="result-title">
                <a href="${escapeHtml(item.url)}" target="_blank" rel="noopener">${escapeHtml(item.title)}</a>
              </h3>
              <span class="result-score">${(item.score * 100).toFixed(1)}%</span>
            </div>
            ${item.summary ? `<p class="result-summary">${escapeHtml(item.summary)}</p>` : ''}
            ${item.tags && item.tags.length > 0 ? `
              <div class="result-tags">
                ${item.tags.slice(0, 5).map(tag => `<span class="tag tag--badge">${escapeHtml(tag)}</span>`).join('')}
              </div>
            ` : ''}
            ${item.chunk_text ? `
              <div class="result-chunk">
                <div class="result-chunk__label">ãƒãƒƒãƒç®‡æ‰€</div>
                ${escapeHtml(item.chunk_text.substring(0, 300))}${item.chunk_text.length > 300 ? '...' : ''}
              </div>
            ` : ''}
          </div>
        `).join('')}</div>`;
        
      } catch (error) {
        results.innerHTML = `<div class="state state--error">æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
      } finally {
        searchBtn.disabled = false;
        searchBtn.textContent = 'æ¤œç´¢';
      }
    });
    
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
